#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Format staged files only
files=$(git diff --cached --name-only --diff-filter=ACMR | grep -E "\.(js|jsx|ts|tsx|css|scss|json|html|md)$" || true)
if [ -n "$files" ]; then
  echo "ğŸ¨ Running Prettier on staged files..."
  if ! npx prettier --write $files; then
    echo "âŒ Prettier formatting failed. Please fix the formatting issues."
    exit 1
  fi
  echo "âœ… Prettier formatting completed"
fi

# Run TypeScript type checking on the client directory only
echo "ğŸ” Running type check on client files..."
if ! npx tsc --noEmit --project client/tsconfig.json; then
  echo "âŒ Type check failed. Please fix the TypeScript errors in client files."
  exit 1
fi
echo "âœ… Type check passed"

# Stage the formatted files
if [ -n "$files" ]; then
  git add $files
fi

echo "âœ¨ Pre-commit checks passed!"
